webpackJsonp([1],{"1/oy":function(t,e){},"93CS":function(t,e){},"9M+g":function(t,e){},Id91:function(t,e){},Jmt5:function(t,e){},"N+7R":function(t,e){},NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a,o=n("woOf"),s=n.n(o),r=n("7+uW"),l=n("fZjL"),i=n.n(l),c=n("mtWM"),u=n.n(c),d={scan:new Audio("static/audio/scan.mp3"),ready:new Audio("static/audio/ready.mp3"),toggle:new Audio("static/audio/clear.mp3"),update:new Audio("static/audio/update.mp3"),play:function(t){this[t].currentTime=0,this[t].play()}},m={name:"app",data:function(){return{user:"CITY SEOUL ( КВ 51 )",isRooms:!0,dismissCountDown:10,showDoor:null,showAlert:null,hideFake:!1,emulateFake:!0,masterState:!0,adaptTemp:!1,muteSound:!1,mustReload:!1,ws:{isOpen:!1,start:!1,error:null,message:"Here will be data",disableDemo:"true"===localStorage.getItem("disableDemo")||!1,autoconnect:"true"===localStorage.getItem("autoconnect")||!1,url:localStorage.getItem("url")}}},created:function(){var t=this;console.log("created",this.ws.autoconnect),this.ws.disableDemo&&console.log("Disabling Demo"),this.$http.get("/meta.json").then(function(e){console.log("Metadata loaded",e.data),t.$root.meta=e.data,t.ws.autoconnect&&t.toggleConnect()}).catch(function(){t.showDoor="No meta.json found on server!"})},watch:{"ws.url":function(t){localStorage.setItem("url",t),this.mustReload=!0},"ws.disableDemo":function(t){localStorage.setItem("disableDemo",t),this.mustReload=!0},emulateFake:function(t){this.$http.get("/fake/"+t).then(function(t){console.log("toggleFake",t.data)})},masterState:function(t){this.$http.get("/master/"+t).then(function(t){console.log("toggleMaster",t.data)})},"ws.autoconnect":function(t){localStorage.setItem("autoconnect",t),this.mustReload=!0}},computed:{fullscreen:function(){return this.$root.fullscreen},data:function(){return this.$root.data}},beforeDestroy:function(){this.ws.isOpen&&this.toggleConnect()},methods:{reload:function(){location.reload()},opendDoor:function(){var t=this;this.$http.get("/opendoor").then(function(e){console.log(e),t.showDoor=e.data}).catch(function(){})},toggleConnect:function(){var t=this;this.ws.isOpen?(a.close(),this.ws.isOpen=!1,a=null):this.$http.get("/data.json").then(function(e){t.$root.data=e.data,t.ws.message=e.data,a=null,(a=new WebSocket("ws://"+t.ws.url)).addEventListener("open",function(e){t.ws.isOpen=!0,a.send("/")}),a.addEventListener("error",function(e){console.error("error",e),t.ws.error=e,t.ws.isOpen=!1}),a.addEventListener("close",function(e){t.ws.isOpen=!1}),a.addEventListener("message",function(e){t.muteSound||d.play("update"),e=JSON.parse(e.data),t.ws.message=e,e.alert?(console.log("ALERT",e.alert),t.showAlert=e.alert):e.master?console.log("MASTER",e.master):i()(e).forEach(function(n){t.$root.data[n]=e[n]})})})}}},f={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:[t.ws.disableDemo?"":"demo",t.fullscreen?"nocursor":""],attrs:{id:"app"}},[n("b-navbar",{staticClass:"bd-navbar",attrs:{toggleable:"md",type:"dark"}},[n("b-nav-toggle",{attrs:{target:"nav_collapse"}}),n("b-navbar-brand",{on:{click:function(e){t.showAlert="с 14:00 по 18:00 будут профилактические работы"}}},[n("div",{staticClass:"logo"}),t.ws.disableDemo?t._e():n("b-badge",[t._v("DEMO")])],1),n("b-navbar-brand",{staticClass:"w100",on:{click:function(e){t.$root.toggleFullScreen()}}},[t._v("SMARTHOME")]),n("b-navbar-nav",{staticClass:"ml-2"},[n("b-nav-form",[n("b-button",{attrs:{size:"sm",variant:t.masterState?"":"danger",pressed:t.masterState},on:{"update:pressed":function(e){t.masterState=e}}},[n("i",{staticClass:"fa fa-power-off mr-1"}),t._v(t._s(t.masterState?"Выключить Все":"Снят с охраны"))]),n("b-button",{staticClass:"ml-2",attrs:{size:"sm",variant:""},on:{click:t.opendDoor}},[n("i",{staticClass:"fa fa-key"}),t._v(" \nДомофон")])],1)],1),n("b-navbar-nav",{staticClass:"ml-auto"},[n("b-nav-item",{attrs:{to:"/home"}},[n("span",{class:{"text-success":!t.isRooms,"text-muted":t.isRooms}},[n("i",{staticClass:"fa fa-home"})])]),n("b-nav-item",{attrs:{to:"/list"}},[n("span",{class:{"text-success":!t.isRooms,"text-muted":t.isRooms}},[n("i",{staticClass:"fa fa-th"})])]),n("b-nav-item",{directives:[{name:"b-modal",rawName:"v-b-modal.communicate",modifiers:{communicate:!0}}]},[n("span",{class:{"text-success":t.ws.isOpen,"text-muted":!t.ws.isOpen}},[n("i",{staticClass:"fa fa-gear"})])]),n("b-nav-item",{directives:[{name:"b-modal",rawName:"v-b-modal",value:"settings",expression:"'settings'"}],staticClass:"ml-3"},[t._v(t._s(t.user))]),n("b-nav-item",{on:{click:t.reload}},[n("i",{staticClass:"fa fa-user"})])],1)],1),n("div",{staticClass:"mx-3 px-2 pt-2",class:{hideFake:t.hideFake}},[n("router-view")],1),null!=t.showAlert?n("b-modal",{attrs:{id:"settings",visible:!0,title:"BI SERVICE - ALERT","header-text-variant":"danger","no-fade":"","hide-footer":"","hide-backdrop":""},on:{hide:function(e){e.preventDefault(),t.showAlert=null}}},[n("div",{staticClass:"text-center"},[n("h4",[t._v("Внимание! ")]),n("p",[t._v(t._s(t.showAlert))]),n("img",{attrs:{height:"200",src:"static/maintenace.jpg"}})])]):t._e(),n("b-modal",{attrs:{id:"communicate",title:"Подключение"}},[n("b-form-group",[n("b-input-group",[n("b-form-input",{attrs:{size:"lg",placeholder:"Server ip:port"},model:{value:t.ws.url,callback:function(e){t.$set(t.ws,"url",e)},expression:"ws.url"}}),n("b-input-group-append",{attrs:{"is-text":""}},[n("span",{staticClass:"mr-2"},[t._v("Auto")]),n("b-form-checkbox",{model:{value:t.ws.autoconnect,callback:function(e){t.$set(t.ws,"autoconnect",e)},expression:"ws.autoconnect"}})],1)],1),n("b-row",{staticClass:"mt-3"},[n("b-col",[n("b-form-group",{attrs:{label:"Hide Fake"}},[n("b-form-checkbox",{model:{value:t.hideFake,callback:function(e){t.hideFake=e},expression:"hideFake"}}),n("b-form-checkbox",{model:{value:t.emulateFake,callback:function(e){t.emulateFake=e},expression:"emulateFake"}})],1)],1),n("b-col",[n("b-form-group",{attrs:{label:"Ajust Temp - 4, Mute"}},[n("b-form-checkbox",{model:{value:t.adaptTemp,callback:function(e){t.adaptTemp=e},expression:"adaptTemp"}}),n("b-form-checkbox",{model:{value:t.muteSound,callback:function(e){t.muteSound=e},expression:"muteSound"}})],1)],1)],1)],1),n("b-list-group",[n("b-list-group-item",[t.ws.error?n("p",{staticClass:"text-danger"},[t._v(t._s(t.ws.error))]):t._e(),n("code",[t._v(t._s(t.ws.message))])])],1),n("template",{slot:"modal-footer"},[n("b-form-checkbox",{attrs:{"button-variant":"primary"},model:{value:t.ws.disableDemo,callback:function(e){t.$set(t.ws,"disableDemo",e)},expression:"ws.disableDemo"}},[t._v("Disable Demo")]),n("b-btn",{attrs:{variant:t.mustReload?"primary":""},on:{click:t.reload}},[t._v("Reload")]),n("b-btn",{attrs:{variant:t.ws.isOpen?"secondary":"primary"},on:{click:t.toggleConnect}},[t._v(t._s(t.ws.isOpen?"Disconnect":"Connect"))])],1)],2),n("b-alert",{staticClass:"bialert",attrs:{dismissible:"",variant:"danger",show:null!=t.showDoor},on:{dismissed:function(e){t.showDoor=null}}},[t._v("Домофон "),n("a",{staticClass:"alert-link ml-2"},[t._v(t._s(t.showDoor))])])],1)},staticRenderFns:[]};var p=n("VU/8")(m,f,!1,function(t){n("N+7R")},null,null).exports,v=n("e6fC");null===localStorage.getItem("url")&&localStorage.setItem("url",location.host);var h=u.a.create({baseURL:location.protocol+"//"+localStorage.getItem("url")}),b={install:function(t){Object.defineProperty(t.prototype,"$http",{value:h})}},g=n("/ocq"),w={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"m-5"},[e("h5",[this._v("Settings")])])}]};var _=n("VU/8")({name:"Settings",data:function(){return{hid:null}},methods:{}},w,!1,function(t){n("rmWy")},null,null).exports,k=r.a.mixin({methods:{sendAction:function(t){if(t){var e=t[0],n=Math.abs(t[1]),a=window.unwrap(t,0,this.data),o=1==a?0:1;console.log("sendAction",e,n,a+"->"+o),this.$http.get("/write/"+e+"/"+n+"/"+o).then(function(){}).catch(function(t){console.error("sendAction with error",t)})}else console.log("nothing to send")}}}),C={name:"Home",data:function(){return{home:{}}},computed:{unstatus:function(){var t=this;return function(e){return window.unwrap(e,2,t.data)}},unvalue:function(){var t=this;return function(e){return window.unwrap(e,0,t.data)}},meta:function(){return this.$root.meta},data:function(){return this.$root.data}},mixins:[k]},S={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.meta?n("div",[n("b-card-group",{staticClass:"uyi rooms main",attrs:{deck:"deck"}},[n("b-card",{attrs:{"no-body":"no-body"}},[n("b-card-body",[n("b-row",{staticClass:"display p-2"},[n("b-col",{attrs:{cols:"3"}},[n("b-button",{staticClass:"mb-2",class:{"text-enable":t.unstatus(t.meta.others.bell)},attrs:{size:"lg"},on:{click:function(e){t.sendAction(t.meta.others.bell)}}},[t._v("Звонок"),t.unvalue(t.meta.others.bell)?n("i",{staticClass:"fa fa-bell-slash ml-2"}):n("i",{staticClass:"fa fa-bell ml-2"})]),t.unvalue(t.meta.others.alarm)?n("b-btn",{staticClass:"text-danger",attrs:{size:"lg"},on:{click:function(e){t.sendAction(t.meta.others.alarm)}}},[t._v("Сирена"),n("i",{staticClass:"fa fa-bolt ml-2"})]):t._e()],1),n("b-col",{staticClass:"w100",attrs:{cols:"4"}},[n("div",[n("small",[t._v("Горячяя Вода ")])]),n("div",[n("small",[t._v("Холодная Вода ")])]),n("div",[n("small",[t._v("Электроэнергия")])]),n("div",[n("small",[t._v("Погода")])])]),n("b-col",{attrs:{cols:"5"}},[n("div",[n("span",{staticClass:"mr-2"},[t._v(t._s(t._f("money")(t._f("unwrap")(t.meta.meters["Гор-Вода"],t.data),"hot")))])]),n("div",[n("span",{staticClass:"mr-2"},[t._v(t._s(t._f("money")(t._f("unwrap")(t.meta.meters["Хол-Вода"],t.data),"cold")))])]),n("div",[n("span",{staticClass:"mr-2"},[t._v(t._s(t._f("money")(t._f("unwrap")(t.meta.meters["Свет"],t.data),"power")))])]),n("div",[n("small",{staticClass:"mr-2"},[n("i",{staticClass:"fa fa-snowflake-o"})]),n("span",{staticClass:"mr-2"},[t._v("-18° ")]),n("small",[t._v("Холодно")])])])],1)],1)],1)],1),n("b-card-group",{staticClass:"uyi rooms",attrs:{deck:"deck"}},t._l(t.meta.rooms,function(e,a){return n("b-card",{key:a,class:{enabled:t.unstatus(e.light),toggled:t.unvalue(e.light)},attrs:{disabled:e.disabled,"no-body":"no-body",align:"center"},on:{click:function(n){t.sendAction(e.light)}}},[n("b-card-header",[t.unvalue(e.pir)?n("i",{staticClass:"fa fa-user-secret mr-1"}):t._e(),t._v(t._s(e.name))]),n("b-card-body",[n("div",{staticClass:"display pt-3"},[e.temp?n("div",{staticClass:"temp"},[t._v(t._s(t._f("numeric")(t.unvalue(e.temp))))]):t._e(),e.humidity?n("div",{staticClass:"humidity"},[t._v(t._s(t.unvalue(e.humidity)))]):t._e(),n("div",{staticClass:"sensors text-center"},[t.unvalue(e.fire)?n("i",{staticClass:"fa fa-fire text-danger mr-1"}):t._e(),t.unvalue(e.leak)?n("i",{staticClass:"fa fa-tint text-danger mr-1"}):t._e(),t.unstatus(e.valve)?n("i",{staticClass:"fa fa-ban text-danger mr-1"}):t._e()])])])],1)}))],1):t._e()},staticRenderFns:[]};var y=n("VU/8")(C,S,!1,function(t){n("93CS")},null,null).exports,E={name:"List",data:function(){return{home:{}}},computed:{unstatus:function(){var t=this;return function(e){return window.unvalue(e,2,t.data)}},unvalue:function(){var t=this;return function(e){return window.unwrap(e,0,t.data)}},meta:function(){return this.$root.meta},data:function(){return this.$root.data}},mixins:[k],methods:{enter:function(t){var e=t.parentElement.dataset.newvalue,n=t.parentElement.dataset.value;t.parentElement.dataset.value=e,0!=e&&1!=e&&null!=n&&(t.parentElement.dataset.dir=e>n?"up":e<n?"down":"")},leave:function(t){t.parentElement.dataset.dir=""}}},x={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.data&&t.meta?n("b-card-group",{staticClass:"uyi devices",attrs:{deck:"deck"}},[t._l(t.meta.slaves,function(e,a){return t._l(e.regs,function(o,s){return o&&!o.includes("CHANGE")?n("b-card",{key:a+":"+s,class:["hub"+a,o.split("."),e.error,e.fake?"fake":"",1==t.unvalue([a,s])?"enabled":""],attrs:{"no-body":"no-body",Zmousedown:"down([s,r])",Zmouseup:"up([s,r])",align:"center"},on:{click:function(e){t.sendAction([a,s])}}},[n("b-card-header",[t._v(t._s(o))]),n("b-card-body",{attrs:{"data-newvalue":t.unvalue([a,s])}},[n("transition",{attrs:{name:o.includes("METER")?"slide-fade":o.includes("RELAY")?"chuh":"blink",duration:{enter:500},mode:"out-in"},on:{leave:t.leave,enter:t.enter}},[o.includes("METER")?n("h4",{key:t.unvalue([a,s]),staticClass:"card-title meters"},[t._v(t._s(t._f("numeric")(t.unvalue([a,s]))))]):n("h4",{key:t.unvalue([a,s]),staticClass:"card-title"},[t._v(t._s(t.unvalue([a,s])))])])],1)],1):t._e()})})],2):t._e()},staticRenderFns:[]};var F=n("VU/8")(E,x,!1,function(t){n("NmDC")},null,null).exports;r.a.use(g.a);var D,R=new g.a({routes:[{path:"/settings",component:_,meta:{isPublic:!0}},{path:"/home",component:y,meta:{isPublic:!0}},{path:"/list",component:F,meta:{isPublic:!0}},{path:"*",redirect:"/home"}],linkActiveClass:"active",onError:function(t){console.error("Router Error",t)}}),$=(n("Jmt5"),n("9M+g"),n("mvHQ")),A=n.n($),O=n("KorX"),M=n.n(O),I=n("C/3r"),L={},N=null;u.a.get("/static/data/data.json").then(function(t){L=t.data}),"true"!==localStorage.getItem("disableDemo")&&(console.log("Enabling Mock Services"),new M.a(h).onGet("/data.json").reply(function(t){return console.log("providing fake data"),[200,L]}).onGet("/meta.json").reply(function(t){return u.a.get("/static/data/meta.json").then(function(t){return N=t.data,console.log("providing fake metadata"),[200,N]})}).onGet("/write/*").reply(function(t){return[200,"OK"]}).onAny().reply(function(t){return[200,"Badaboom"]}),D=new I.Server("ws://"+localStorage.getItem("url")),window.WebSocket=I.WebSocket,D.on("connection",function(t){console.log("started mock socket demo",t),t.on("close",function(){console.log("stopping mock socket demo"),window.clearInterval(T)}),function(t){window.clearInterval(T),T=window.setInterval(function(){var e=i()(L),n=e[j(0,e.length-1)],a=L[n],o=j(0,a.length-1),s={};s[n]=a,s[n][o]=a[o]>1?j(10,100):j(0,1),t.send(A()(s))},5e3)}(t)}));var T=null;function j(t,e){return Math.floor(Math.random()*(e-t+1))+t}var z=n("ViqS"),q=n.n(z);q.a.localeData().delimiters.thousands=" ",r.a.filter("date",function(t){return t?t.toLocaleString("ru",{year:"numeric",month:"short",day:"numeric"}).initCap():""}),r.a.filter("datetime",function(t){return t?t.toLocaleString("ru",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"}):""}),r.a.filter("numeric",function(t){return q()(t).format("0,0")}),String.prototype.initCap=function(){return this.toLowerCase().replace("г.","").replace(/(?:^|\s)[a-zа-я]/g,function(t){return t.toUpperCase()})},r.a.filter("humanizer",function(t,e,n){return"SENSOR"==n?0==t?"○":1==t?"●":t:"RELAY"==n&&"TOGGLE"==e?0==t?"DN":1==t?"UP":t:0==t?"OFF":1==t?"ON":t}),r.a.filter("adjuster",function(t,e,n){return"TEMP"==e&&n?t-4:t});var U=null,W=0,H=null,P=0,G=null,V=0;function J(t,e,n){return n&&t&&t[e]&&n[t[e]]&&null!=n[t[e]][Math.abs(t[e+1])]?t[e+1]<0?1==n[t[0]][Math.abs(t[e+1])]?0:1:n[t[0]][Math.abs(t[e+1])]:null}r.a.filter("money",function(t,e){return null==t?"-":"cold"==e?(H!=t&&null!=H&&P++,H=t,((454+10*P)/1e3).toFixed(2)+"m3 ( "+5*t+"тг)"):"hot"==e?(G!=t&&null!=G&&V++,G=t,((1095+10*V)/1e3).toFixed(2)+"m3 ("+10*t+"тг)"):"power"==e?(U!=t&&null!=U&&W++,U=t,((15300+1e3*W/3200)/1e3).toFixed(2)+" kW ("+Math.ceil(.1*t)+"тг)"):t}),r.a.filter("unwrap",function(t,e){return J(t,0,e)}),window.unwrap=J,r.a.use(v.a),r.a.use(b),r.a.config.productionTip=!1,r.a.mixin({methods:{$resetData:function(t){console.log("reset global data =",this.$options.name),s()(this.$data,this.$options.data.call(this)),(null!==t&&t||null==t)&&this.$emit("reset",null)},$_clone:function(t){return s()({},t)},$:function(t){return document.querySelector(t)},$ArrayRemoveElement:function(t,e){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}}}),new r.a({el:"#app",data:function(){return{fullscreen:!1,value:0,meta:null,data:null}},created:function(){window.addEventListener("com",this.read)},mounted:function(){},watch:{},beforeDestroy:function(){window.removeEventListener("com",this.read)},router:R,methods:{read:function(t){isNaN(t.detail)?console.error("is not a number"):this.value=t.detail},toggleFullScreen:function(){document.fullScreenElement&&null!==document.fullScreenElement||!document.mozFullScreen&&!document.webkitIsFullScreen?(document.documentElement.requestFullScreen?document.documentElement.requestFullScreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullScreen&&document.documentElement.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT),this.fullscreen=!0):(document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen(),this.fullscreen=!1)}},render:function(t){return t(p)}})},NmDC:function(t,e){},rmWy:function(t,e){},zj2Q:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.261f641a0490e8ede2b1.js.map